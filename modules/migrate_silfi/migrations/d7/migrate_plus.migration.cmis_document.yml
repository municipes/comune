uuid: b71f66df-29b2-451a-992f-b1927d2549e5
langcode: it
status: true
id: cmis_document
migration_tags:
  - 'Drupal 7'
  - Content
migration_group: migrate_drupal_7
label: 'CMIS Document to Documento pubblico'

source:
  plugin: cmis_document_json
  data_fetcher_plugin: file
  data_parser_plugin: json
  host: "http://192.168.97.41:8080/alfresco/api/-default-/public/cmis/versions/1.1/atom"
  user: "pontassieve"
  pass: "FwtBzp6LZJ2JJb5V"
  node_type: allegato_documentale
  track_changes: true

  urls:
    - modules/custom/silfi_migrate/json/alfresco_files.json

  # An xpath-like selector corresponding to the items to be imported.
  item_selector: content

  fields:
    - name: object_id
      label: 'ID CMIS'
      selector: id
    - name: descrizione
      label: 'Descrizione oggetto'
      selector: descrizione
    - name: titolo
      label: 'Titolo oggetto'
      selector: titolo
    - name: visibile
      label: 'Visibilit√† oggetto'
      selector: visibile
    - name: albo_pretorio
      label: 'Appartenenza ad Albo Pretorio'
      selector: alboPretorio
    - name: type
      label: 'Tipologia oggetto'
      selector: cmisObjectTypeId
    - name: oggetto
      label: 'Base oggetto'
      selector: base.oggetto
    - name: file_name
      label: 'Nome del file'
      selector: cmisContentStreamFileName
    - name: data_modifica
      label: 'Data modifica'
      selector: verificabile.modifica

  ids:
    object_id:
      type: string

process:
  # nid:
  #   -
  #     plugin: get
  #     source: tnid
  # vid:
  #   -
  #     plugin: get
  #     source: vid
  langcode:
    -
      plugin: default_value
      # source: language
      default_value: it
  title:
    -
      plugin: get
      source: title
  uid:
    -
      plugin: default_value
      default_value: 1
  status:
    -
      plugin: get
      source: status
  created:
    -
      plugin: get
      source: created
  changed:
    -
      plugin: get
      source: changed

  field_tipo_di_accesso/target_id:
    -
      plugin: default_value
      default_value: 424

  field_autori: author

  field_data_inizio: val_start

  field_data_fine: val_end

  field_descrizione_completa:
    plugin: sub_process
    source: description
    process:
      value: value
      format:
        plugin: default_value
        default_value: 'bootstrap_italia_2'

  field_descrizione_breve: abstract

  field_identificativo: file_cmis_id

  field_licenza_di_distribuzione:
    plugin: default_value
    default_value: 149

  field_tipo_di_documento:
    plugin: sub_process
    source: tipo_documento
    process:
      target_id:
        plugin: static_map
        source: tipo_documento
        map:
          'Moduli': 47
          'Allegati': 55
          'Atti': 52
          # 'Delibere':
          # 'Determine':
          # 'Ordinanze':
          'Regolamenti': 51

  field_file:
    plugin: migration_lookup
    migration: cmis_file_via_json
    source: file_cmis_id
    no_stub: true


destination:
  plugin: 'entity:node'
  default_bundle: documento_pubblico
migration_dependencies: {}

dependencies:
  enforced:
    module:
      - silfi_migrate
