uuid: 81f01d45-7351-46ec-b1b0-6c68334ec3f0
langcode: it
status: true
dependencies:
  enforced:
    module:
      - migrate_silfi
id: upgrade_cmis_file
# class: Drupal\migrate\Plugin\Migration
# field_plugin_method: null
# cck_plugin_method: null
migration_tags:
  - 'Drupal 7'
  - Content
migration_group: migrate_drupal_7
label: 'CMIS files'
source:
  plugin: cmis_file
  host: "http://192.168.97.41:8080/alfresco/api/-default-/public/cmis/versions/1.1/atom"
  user: "pontassieve"
  pass: "FwtBzp6LZJ2JJb5V"
  track_changes: true
  scheme: public
  ids:
    object_id:
      type: string
  constants:
    source_base_path: 'https://www.comune.pontassieve.fi.it/cmis/browser?id='
    DRUPAL_FILE_DIRECTORY: 'public://documenti_pubblici/'
process:
  # fid:
  #   -
  #     plugin: get
  #     source: fid
  filename:
    -
      plugin: skip_on_empty
      method: row
      source: filename
      message: 'File name is missing'

  source_full_path:
    -
      plugin: concat
      # delimiter: /
      source:
        - constants/source_base_path
        - object_id
    # -
    #   plugin: urlencode
  destination_full_path:
    -
      plugin: concat
      # delimiter: /
      source:
        - constants/DRUPAL_FILE_DIRECTORY
        - uri
    # -
    #   plugin: urlencode
  uri:
    -
      plugin: file_copy
      source:
        - '@source_full_path'
        - '@destination_full_path'
      file_exists: 'rename'
      move: FALSE
  filemime:
    -
      plugin: get
      source: filemime
  status:
    -
      plugin: default_value
      default_value: 1
  created:
    -
      plugin: get
      source: created
  changed:
    -
      plugin: get
      source: changed
  uid:
    -
      plugin: default_value
      default_value: 1
destination:
  plugin: 'entity:file'
migration_dependencies:
  required:
    - upgrade_d7_file
  optional: {  }
